{% extends "page.html" %}

{% block content %}

{% if indexdirdesc or indexdirmeta %}
  <ul class="InfoList">
  {% if indexdirdesc %}
    <li><div class="FileComments">{{ indexdirdesc }}</div>
  {% endif %}
  {% if indexdirmeta %}
    {% for key, val in indexdirmeta %}
    <li class="MetadataLine">{{ key }}: {{ val }}
    {% endfor %}
  {% endif %}
  </ul>
{% endif %}

{% block prefilelist %}{% endblock %}

{% if not files %}
  <p>No files in <code>/{{ dirname }}</code>.<p>
{% endif %}

<dl class="FileList">
  {% for file in files %}
    {% set isselected = (op and opfile == file.name) %}

    <dt>
    {% if not file.islink %}
      <span class="Details"><span class="Tabular">{{ file.fdate }}</span>
      {% if not file.isspecial %}
        <a href="{{ approot }}/{{ uribase|urlencode }}?view=info&amp;filename={{ file.name|urlencode }}">(info)</a>
      {% else %}
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      {% endif %}
      :</span>
      <code><a href="{{ approot }}/{{ uribase|urlencode }}?view=dl&amp;filename={{ file.name|urlencode }}">{{ file.name }}</a></code>
      <span class="Details">({{ file.size|delimnumber }} bytes)</span>

      {% if file.indexdesc or file.indexmeta %}
      <dd class="FileInfoList">
        <ul>
        {% if file.indexdesc %}
        <div class="FileComments">{{ file.indexdesc }}</div>
        {% endif %}
        {% if file.indexmeta %}
          {% for key, val in file.indexmeta %}
          <li class="MetadataLine">{{ key }}: {{ val }}
          {% endfor %}
        {% endif %}
        </ul>
      {% endif %}
      
      {% if fileops and not file.isspecial %}
      {% include "filebuttons.html" %}
      {% endif %}

    {% else %}
      <span class="Details"><span class="Tabular">{{ file.fdate }}</span>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      :</span>
      <code>{{ file.name }}</code>
      <span class="Details">(symlink
      {% if file.broken %}<b>broken</b>{% endif %}
      &#x2192;
      {% if file.broken %}
        <code>{{ file.target }}</code>
      {%- else -%}
        <code><a href="{{ approot }}/{{ file.realuri|urlencode }}">{{ file.target }}</a></code>
      {%- endif -%}
      )</span>
    {% endif %}

  {% endfor %}
</dl>

{% block postfilelist %}{% endblock %}

{% if formerror %}
<p>{{ formerror }}</p>
{% endif %}

{% if fileops %}
{% include "filebuttonresult.html" %}
{% endif %}

{% endblock %}
